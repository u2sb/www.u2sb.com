import{u as B,g as ee,h as se,i as M,j as ae,k as le,t as te,l as ie,m as L,n as H,p as re,w as ue,q as a,v as ne,R as $,x as oe,y as me,z as ce,D as pe,A as ve,B as he,C as de,E as ye,F as Se,G as f,H as ge,I as we,J as Oe,K as xe,L as P,M as F,N as be}from"./app-DVgRyx94.js";const He=["/","/OpenHw/","/OpenSw/","/pages/About.html","/OpenSw/Danmu.Server/","/OpenSw/Danmu.Server/artplayer-danmu.html","/OpenSw/Danmu.Server/dplayer-danmu.html","/OpenSw/Danmu.Server/install-on-baota.html","/OpenSw/Danmu.Server/install.html","/OpenSw/Overview/public-service.html","/OpenSw/UnitySbTemplate/","/OpenSw/UnitySbTemplate/SbGameObject.html","/OpenSw/UnitySbTemplate/UnityPackageOffline.html","/OpenSw/hexo-tag-mmedia/","/OpenSw/hexo-tag-mmedia/aplayer.html","/OpenSw/hexo-tag-mmedia/artplayer.html","/OpenSw/hexo-tag-mmedia/audio.html","/OpenSw/hexo-tag-mmedia/bilibili.html","/OpenSw/hexo-tag-mmedia/developer-doc.html","/OpenSw/hexo-tag-mmedia/dplayer.html","/OpenSw/hexo-tag-mmedia/install.html","/OpenSw/hexo-tag-mmedia/meting.html","/OpenSw/hexo-tag-mmedia/version0.html","/OpenSw/hexo-tag-mmedia/video.html","/OpenSw/hexo-tag-mmedia/xigua.html","/OpenSw/vuepress-plugin-sbaudio/","/OpenSw/vuepress-plugin-sbaudio/aplayer.html","/OpenSw/vuepress-plugin-sbaudio/aplayerGlobal.html","/OpenSw/vuepress-plugin-sbaudio/install.html","/OpenSw/vuepress-plugin-sbaudio/meting.html","/OpenHw/CameraBattery/DMW-BLK22/","/OpenHw/ObsKeyboard/SB00/","/OpenSw/UnitySbTemplate/ThirdPartyPackageExt/","/OpenSw/UnitySbTemplate/ThirdPartyPackageExt/UniTask.YooAsset.html","/404.html","/pages/","/OpenSw/Overview/","/OpenHw/CameraBattery/","/OpenHw/ObsKeyboard/"],fe="SLIMSEARCH_QUERY_HISTORY",y=B(fe,[]),ke=()=>{const{queryHistoryCount:l}=f,t=l>0;return{enabled:t,queryHistories:y,addQueryHistory:i=>{t&&(y.value=Array.from(new Set([i,...y.value.slice(0,l-1)])))},removeQueryHistory:i=>{y.value=[...y.value.slice(0,i),...y.value.slice(i+1)]}}},U=l=>He[l.id]+("anchor"in l?`#${l.anchor}`:""),Re="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=f,S=B(Re,[]),Ce=()=>{const l=j>0;return{enabled:l,resultHistories:S,addResultHistory:t=>{if(l){const i={link:U(t),display:t.display};"header"in t&&(i.header=t.header),S.value=[i,...S.value.slice(0,j-1)]}},removeResultHistory:t=>{S.value=[...S.value.slice(0,t),...S.value.slice(t+1)]}}},qe=l=>{const t=pe(),i=M(),k=ve(),u=L(0),w=H(()=>u.value>0),h=he([]);return de(()=>{const{search:d,terminate:R}=ye(),g=Se(o=>{const{resultsFilter:O=n=>n,querySplitter:A,suggestionsFilter:C,...q}=t.value;o?(u.value+=1,d(o,i.value,q).then(n=>O(n,o,i.value,k.value)).then(n=>{u.value-=1,h.value=n}).catch(n=>{console.warn(n),u.value-=1,u.value||(h.value=[])})):h.value=[]},f.searchDelay-f.suggestDelay,{maxWait:5e3});ge([l,i],([o])=>g(o.join(" "))),we(()=>{R()})}),{isSearching:w,results:h}};var Qe=ee({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:t}){const i=se(),k=M(),u=ae(le),{enabled:w,addQueryHistory:h,queryHistories:d,removeQueryHistory:R}=ke(),{enabled:g,resultHistories:o,addResultHistory:O,removeResultHistory:A}=Ce(),C=w||g,q=te(l,"queries"),{results:n,isSearching:K}=qe(q),r=ie({isQuery:!0,index:0}),p=L(0),v=L(0),E=H(()=>C&&(d.value.length>0||o.value.length>0)),D=H(()=>n.value.length>0),Q=H(()=>n.value[p.value]||null),Y=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?o.value.length-1:d.value.length-1):r.index=s-1},_=()=>{const{isQuery:e,index:s}=r;s===(e?d.value.length-1:o.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},G=()=>{p.value=p.value>0?p.value-1:n.value.length-1,v.value=Q.value.contents.length-1},W=()=>{p.value=p.value<n.value.length-1?p.value+1:0,v.value=0},z=()=>{v.value<Q.value.contents.length-1?v.value+=1:W()},J=()=>{v.value>0?v.value-=1:G()},T=e=>e.map(s=>be(s)?s:a(s[0],s[1])),N=e=>{if(e.type==="customField"){const s=Oe[e.index]||"$content",[m,b=""]=xe(s)?s[k.value].split("$content"):s.split("$content");return e.display.map(c=>a("div",T([m,...c,b])))}return e.display.map(s=>a("div",T(s)))},x=()=>{p.value=0,v.value=0,t("updateQuery",""),t("close")},V=()=>w?a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},u.value.queryHistory),d.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{t("updateQuery",e)}},[a(P,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:F,onClick:m=>{m.preventDefault(),m.stopPropagation(),R(s)}})]))])):null,X=()=>g?a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},u.value.resultHistory),o.value.map((e,s)=>a($,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{x()}},()=>[a(P,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(m=>T(m)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:F,onClick:m=>{m.preventDefault(),m.stopPropagation(),A(s)}})]))])):null;return re("keydown",e=>{if(l.isFocusing){if(D.value){if(e.key==="ArrowUp")J();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const s=Q.value.contents[v.value];h(l.queries.join(" ")),O(s),i.push(U(s)),x()}}else if(g){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")_();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(t("updateQuery",d.value[s]),e.preventDefault()):(i.push(o.value[s].link),x())}}}}),ue([p,v],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!D.value:!E.value}],id:"slimsearch-results"},l.queries.length?K.value?a(ne,{hint:u.value.searching}):D.value?a("ul",{class:"slimsearch-result-list"},n.value.map(({title:e,contents:s},m)=>{const b=p.value===m;return a("li",{class:["slimsearch-result-list-item",{active:b}]},[a("div",{class:"slimsearch-result-title"},e||u.value.defaultTitle),s.map((c,Z)=>{const I=b&&v.value===Z;return a($,{to:U(c),class:["slimsearch-result-item",{active:I,"aria-selected":I}],onClick:()=>{h(l.queries.join(" ")),O(c),x()}},()=>[c.type==="text"?null:a(c.type==="title"?oe:c.type==="heading"?me:ce,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?a("div",{class:"content-header"},c.header):null,a("div",N(c))])])})])})):u.value.emptyResult:C?E.value?[V(),X()]:u.value.emptyHistory:u.value.emptyResult)}});export{Qe as default};
