import{k as N,u as X,l as $,m as Z,y as ee,t as se,n as ae,p as D,q as x,v as a,x as te,w as le,z as ie,R as U,A as re,B as ue,D as ne,E as oe,F as me,G as E,H as P,J as ce,K as pe,L as ve,M as he,N as de,O as ye,Q as Se,S as we,T as B,U as ge,V as H}from"./app-CfxnFdGK.js";const Oe=["/","/OpenHw/","/OpenSw/","/pages/About.html","/OpenSw/Danmu.Server/","/OpenSw/Danmu.Server/artplayer-danmu.html","/OpenSw/Danmu.Server/dplayer-danmu.html","/OpenSw/Danmu.Server/install-on-baota.html","/OpenSw/Danmu.Server/install.html","/OpenSw/Overview/public-service.html","/OpenSw/SbModbus/BitConverter.html","/OpenSw/SbModbus/","/OpenSw/UnitySbTemplate/","/OpenSw/UnitySbTemplate/SbGameObject.html","/OpenSw/UnitySbTemplate/UnityPackageOffline.html","/OpenSw/hexo-tag-mmedia/","/OpenSw/hexo-tag-mmedia/aplayer.html","/OpenSw/hexo-tag-mmedia/artplayer.html","/OpenSw/hexo-tag-mmedia/audio.html","/OpenSw/hexo-tag-mmedia/bilibili.html","/OpenSw/hexo-tag-mmedia/developer-doc.html","/OpenSw/hexo-tag-mmedia/dplayer.html","/OpenSw/hexo-tag-mmedia/install.html","/OpenSw/hexo-tag-mmedia/meting.html","/OpenSw/hexo-tag-mmedia/version0.html","/OpenSw/hexo-tag-mmedia/video.html","/OpenSw/hexo-tag-mmedia/xigua.html","/OpenSw/vuepress-plugin-sbaudio/","/OpenSw/vuepress-plugin-sbaudio/aplayer.html","/OpenSw/vuepress-plugin-sbaudio/aplayerGlobal.html","/OpenSw/vuepress-plugin-sbaudio/install.html","/OpenSw/vuepress-plugin-sbaudio/meting.html","/OpenHw/CameraBattery/DMW-BLK22/","/OpenHw/ObsKeyboard/SB00/","/OpenSw/SbModbus/SourceGenerator/SbModbusArrayAttribute.html","/OpenSw/SbModbus/SourceGenerator/SbModbusStructAttribute.html","/OpenSw/UnitySbTemplate/ThirdPartyPackageExt/","/OpenSw/UnitySbTemplate/ThirdPartyPackageExt/UniTask.YooAsset.html","/404.html","/pages/","/OpenSw/Overview/","/OpenHw/CameraBattery/","/OpenHw/ObsKeyboard/","/OpenSw/SbModbus/SourceGenerator/"],be="SLIMSEARCH_QUERY_HISTORY",y=B(be,[]),xe=()=>{const{queryHistoryCount:l}=H;return{enabled:l>0,queryHistories:y,addQueryHistory:u=>{y.value=Array.from(new Set([u,...y.value.slice(0,l-1)]))},removeQueryHistory:u=>{y.value=[...y.value.slice(0,u),...y.value.slice(u+1)]}}},T=l=>Oe[l.id]+("anchor"in l?`#${l.anchor}`:""),He="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:I}=H,S=B(He,[]),fe=()=>({enabled:I>0,resultHistories:S,addResultHistory:r=>{{const u={link:T(r),display:r.display};"header"in r&&(u.header=r.header),S.value=[u,...S.value.slice(0,I-1)]}},removeResultHistory:r=>{S.value=[...S.value.slice(0,r),...S.value.slice(r+1)]}}),ke=l=>{const r=ce(),u=$(),f=pe(),n=D(0),w=x(()=>n.value>0),c=ve([]);return he(()=>{const{search:k,terminate:v}=de(),g=Se(h=>{const{resultsFilter:R=t=>t,querySplitter:d,suggestionsFilter:A,...i}=r.value;h?(n.value+=1,k(h,u.value,i).then(t=>R(t,h,u.value,f.value)).then(t=>{n.value-=1,c.value=t}).catch(t=>{console.warn(t),n.value-=1,n.value||(c.value=[])})):c.value=[]},H.searchDelay-H.suggestDelay,{maxWait:5e3});ye([l,u],([h])=>g(h.join(" "))),we(()=>{v()})}),{isSearching:w,results:c}};var Qe=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:r}){const u=X(),f=$(),n=Z(ee),{addQueryHistory:w,queryHistories:c,removeQueryHistory:k}=xe(),{resultHistories:v,addResultHistory:g,removeResultHistory:h}=fe(),R=se(l,"queries"),{results:d,isSearching:A}=ke(R),i=ae({isQuery:!0,index:0}),t=D(0),p=D(0),L=x(()=>c.value.length>0||v.value.length>0),Q=x(()=>d.value.length>0),q=x(()=>d.value[t.value]||null),F=()=>{const{isQuery:e,index:s}=i;s===0?(i.isQuery=!e,i.index=e?v.value.length-1:c.value.length-1):i.index=s-1},G=()=>{const{isQuery:e,index:s}=i;s===(e?c.value.length-1:v.value.length-1)?(i.isQuery=!e,i.index=0):i.index=s+1},j=()=>{t.value=t.value>0?t.value-1:d.value.length-1,p.value=q.value.contents.length-1},K=()=>{t.value=t.value<d.value.length-1?t.value+1:0,p.value=0},Y=()=>{p.value<q.value.contents.length-1?p.value+=1:K()},_=()=>{p.value>0?p.value-=1:j()},C=e=>e.map(s=>ge(s)?s:a(s[0],s[1])),V=e=>{if(e.type==="customField"){const s=oe[e.index]||"$content",[o,b=""]=me(s)?s[f.value].split("$content"):s.split("$content");return e.display.map(m=>a("div",C([o,...m,b])))}return e.display.map(s=>a("div",C(s)))},O=()=>{t.value=0,p.value=0,r("updateQuery",""),r("close")},W=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.queryHistory),c.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:i.isQuery&&i.index===s}],onClick:()=>{r("updateQuery",e)}},[a(E,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:P,onClick:o=>{o.preventDefault(),o.stopPropagation(),k(s)}})]))])),z=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.resultHistory),v.value.map((e,s)=>a(U,{to:e.link,class:["slimsearch-result-item",{active:!i.isQuery&&i.index===s}],onClick:()=>{O()}},()=>[a(E,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(o=>C(o)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:P,onClick:o=>{o.preventDefault(),o.stopPropagation(),h(s)}})]))]));return te("keydown",e=>{if(l.isFocusing){if(Q.value){if(e.key==="ArrowUp")_();else if(e.key==="ArrowDown")Y();else if(e.key==="Enter"){const s=q.value.contents[p.value];w(l.queries.join(" ")),g(s),u.push(T(s)),O()}}else if(e.key==="ArrowUp")F();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const{index:s}=i;i.isQuery?(r("updateQuery",c.value[s]),e.preventDefault()):(u.push(v.value[s].link),O())}}}),le([t,p],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!Q.value:!L.value}],id:"slimsearch-results"},l.queries.length?A.value?a(ie,{hint:n.value.searching}):Q.value?a("ul",{class:"slimsearch-result-list"},d.value.map(({title:e,contents:s},o)=>{const b=t.value===o;return a("li",{class:["slimsearch-result-list-item",{active:b}]},[a("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((m,J)=>{const M=b&&p.value===J;return a(U,{to:T(m),class:["slimsearch-result-item",{active:M,"aria-selected":M}],onClick:()=>{w(l.queries.join(" ")),g(m),O()}},()=>[m.type==="text"?null:a(m.type==="title"?re:m.type==="heading"?ue:ne,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[m.type==="text"&&m.header?a("div",{class:"content-header"},m.header):null,a("div",V(m))])])})])})):n.value.emptyResult:L.value?[W(),z()]:n.value.emptyHistory)}});export{Qe as default};
