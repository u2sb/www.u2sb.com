var Jt=Object.defineProperty;var ot=n=>{throw TypeError(n)};var Qt=(n,t,s)=>t in n?Jt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var M=(n,t,s)=>Qt(n,typeof t!="symbol"?t+"":t,s),Q=(n,t,s)=>t.has(n)||ot("Cannot "+s);var e=(n,t,s)=>(Q(n,t,"read from private field"),s?s.call(n):t.get(n)),d=(n,t,s)=>t.has(n)?ot("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,s),c=(n,t,s,r)=>(Q(n,t,"write to private field"),r?r.call(n,s):t.set(n,s),s),a=(n,t,s)=>(Q(n,t,"access private method"),s);import{b0 as Xt,P as ut,a3 as q,be as Zt,T as te,aA as nt,W as lt,bf as _,bg as ee,bh as ie,V as se,a8 as ae,an as rt,aY as dt,b6 as ne,bi as X,$ as Z}from"./app-23VE9sTv.js";import{R as re}from"./vidstack-DSYpsFWk-RAM_Qcja.js";let B=null,K=[],Y=[];function ht(){return B??(B=new AudioContext)}function he(){const n=ht(),t=n.createGain();return t.connect(n.destination),K.push(t),t}function oe(n,t){const s=ht(),r=s.createMediaElementSource(n);return t&&r.connect(t),Y.push(r),r}function de(n){const t=K.indexOf(n);t!==-1&&(K.splice(t,1),n.disconnect(),ft())}function ce(n){const t=Y.indexOf(n);t!==-1&&(Y.splice(t,1),n.disconnect(),ft())}function ft(){B&&K.length===0&&Y.length===0&&B.close().then(()=>{B=null})}var R,A,m,p,P,mt,tt;class ue{constructor(t,s){d(this,P);d(this,R);d(this,A);d(this,m,null);d(this,p,null);c(this,R,t),c(this,A,s)}get currentGain(){var t,s;return((s=(t=e(this,m))==null?void 0:t.gain)==null?void 0:s.value)??null}get supported(){return!0}setGain(t){const s=this.currentGain;if(t!==this.currentGain){if(t===1&&s!==1){this.removeGain();return}e(this,m)||(c(this,m,he()),e(this,p)&&e(this,p).connect(e(this,m))),e(this,p)||c(this,p,oe(e(this,R),e(this,m))),e(this,m).gain.value=t,e(this,A).call(this,t)}}removeGain(){e(this,m)&&(e(this,p)&&e(this,p).connect(ht().destination),a(this,P,tt).call(this),e(this,A).call(this,null))}destroy(){a(this,P,mt).call(this),a(this,P,tt).call(this)}}R=new WeakMap,A=new WeakMap,m=new WeakMap,p=new WeakMap,P=new WeakSet,mt=function(){if(e(this,p))try{ce(e(this,p))}catch{}finally{c(this,p,null)}},tt=function(){if(e(this,m))try{de(e(this,m))}catch{}finally{c(this,m,null)}};const le=["focus","blur","visibilitychange","pageshow","pagehide"];var S,E,O,z,pt;class fe{constructor(){d(this,z);d(this,S,Z(ct()));d(this,E,Z(document.visibilityState));d(this,O)}connect(){const t=new nt(window),s=a(this,z,pt).bind(this);for(const r of le)t.add(r,s);_&&t.add("beforeunload",r=>{c(this,O,setTimeout(()=>{r.defaultPrevented||r.returnValue.length>0||(e(this,S).set("hidden"),e(this,E).set("hidden"))},0))})}get pageState(){return e(this,S).call(this)}get visibility(){return e(this,E).call(this)}}S=new WeakMap,E=new WeakMap,O=new WeakMap,z=new WeakSet,pt=function(t){_&&window.clearTimeout(e(this,O)),(t.type!=="blur"||e(this,S).call(this)==="active")&&(e(this,S).set(ct(t)),e(this,E).set(document.visibilityState=="hidden"?"hidden":"visible"))};function ct(n){return(n==null?void 0:n.type)==="blur"||document.visibilityState==="hidden"?"hidden":document.hasFocus()?"active":"passive"}var D,h,b,x,L,v,I,$,i,o,yt,G,N,gt,bt,Tt,kt,J,at,u,pe,k,St,et,vt,wt,Pt,W,Ct,At,Et,xt,Lt,$t,Gt,Nt,Mt,Rt,Ot,Dt,It,Ht,Ft,Ut,Vt,jt;class me{constructor(t,s){d(this,i);d(this,D);d(this,h);d(this,b,!1);d(this,x,!1);d(this,L,!1);d(this,v,new re(a(this,i,gt).bind(this)));d(this,I,new fe);d(this,$);d(this,G,0);d(this,N,-1);d(this,J);d(this,at);c(this,D,t),c(this,h,s),c(this,$,new nt(t.media)),a(this,i,bt).call(this),e(this,I).connect(),lt(a(this,i,Mt).bind(this)),ut(a(this,i,yt).bind(this))}}D=new WeakMap,h=new WeakMap,b=new WeakMap,x=new WeakMap,L=new WeakMap,v=new WeakMap,I=new WeakMap,$=new WeakMap,i=new WeakSet,o=function(){return e(this,D).media},yt=function(){var t;c(this,x,!1),c(this,L,!1),e(this,v).stop(),e(this,$).abort(),(t=e(this,J))==null||t.clear()},G=new WeakMap,N=new WeakMap,gt=function(){const t=e(this,i,o).currentTime;!(_&&t-e(this,N)<.35)&&e(this,G)!==t&&(a(this,i,k).call(this,t),c(this,G,t))},bt=function(){a(this,i,u).call(this,"loadstart",a(this,i,St)),a(this,i,u).call(this,"abort",a(this,i,et)),a(this,i,u).call(this,"emptied",a(this,i,vt)),a(this,i,u).call(this,"error",a(this,i,jt)),a(this,i,u).call(this,"volumechange",a(this,i,Dt))},Tt=function(){e(this,x)||(a(this,i,u).call(this,"loadeddata",a(this,i,wt)),a(this,i,u).call(this,"loadedmetadata",a(this,i,Pt)),a(this,i,u).call(this,"canplay",a(this,i,Et)),a(this,i,u).call(this,"canplaythrough",a(this,i,xt)),a(this,i,u).call(this,"durationchange",a(this,i,Ot)),a(this,i,u).call(this,"play",a(this,i,Ct)),a(this,i,u).call(this,"progress",a(this,i,Ft)),a(this,i,u).call(this,"stalled",a(this,i,$t)),a(this,i,u).call(this,"suspend",a(this,i,Ut)),a(this,i,u).call(this,"ratechange",a(this,i,Vt)),c(this,x,!0))},kt=function(){e(this,L)||(a(this,i,u).call(this,"pause",a(this,i,At)),a(this,i,u).call(this,"playing",a(this,i,Lt)),a(this,i,u).call(this,"seeked",a(this,i,It)),a(this,i,u).call(this,"seeking",a(this,i,Ht)),a(this,i,u).call(this,"ended",a(this,i,Nt)),a(this,i,u).call(this,"waiting",a(this,i,Gt)),c(this,L,!0))},J=new WeakMap,at=new WeakMap,u=function(t,s){e(this,$).add(t,s.bind(this))},pe=function(t){},k=function(t,s){const r=Math.min(t,e(this,h).$state.seekableEnd());e(this,h).notify("time-change",r,s)},St=function(t){if(e(this,i,o).networkState===3){a(this,i,et).call(this,t);return}a(this,i,Tt).call(this),e(this,h).notify("load-start",void 0,t)},et=function(t){e(this,h).notify("abort",void 0,t)},vt=function(){e(this,h).notify("emptied",void 0,event)},wt=function(t){e(this,h).notify("loaded-data",void 0,t)},Pt=function(t){c(this,G,0),c(this,N,-1),a(this,i,kt).call(this),e(this,h).notify("loaded-metadata",void 0,t),(ee||_&&ie(e(this,h).$state.source()))&&e(this,h).delegate.ready(a(this,i,W).call(this),t)},W=function(){return{provider:se(e(this,h).$provider),duration:e(this,i,o).duration,buffered:e(this,i,o).buffered,seekable:e(this,i,o).seekable}},Ct=function(t){e(this,h).$state.canPlay&&e(this,h).notify("play",void 0,t)},At=function(t){e(this,i,o).readyState===1&&!e(this,b)||(c(this,b,!1),e(this,v).stop(),e(this,h).notify("pause",void 0,t))},Et=function(t){e(this,h).delegate.ready(a(this,i,W).call(this),t)},xt=function(t){e(this,h).$state.started()||e(this,h).notify("can-play-through",a(this,i,W).call(this),t)},Lt=function(t){e(this,i,o).paused||(c(this,b,!1),e(this,h).notify("playing",void 0,t),e(this,v).start())},$t=function(t){e(this,h).notify("stalled",void 0,t),e(this,i,o).readyState<3&&(c(this,b,!0),e(this,h).notify("waiting",void 0,t))},Gt=function(t){e(this,i,o).readyState<3&&(c(this,b,!0),e(this,h).notify("waiting",void 0,t))},Nt=function(t){e(this,v).stop(),a(this,i,k).call(this,e(this,i,o).duration,t),e(this,h).notify("end",void 0,t),e(this,h).$state.loop()&&ae(e(this,i,o).controls)&&(e(this,i,o).controls=!1)},Mt=function(){const t=e(this,h).$state.paused(),s=e(this,I).visibility==="hidden";(t||s)&&rt(e(this,i,o),"timeupdate",a(this,i,Rt).bind(this))},Rt=function(t){a(this,i,k).call(this,e(this,i,o).currentTime,t)},Ot=function(t){e(this,h).$state.ended()&&a(this,i,k).call(this,e(this,i,o).duration,t),e(this,h).notify("duration-change",e(this,i,o).duration,t)},Dt=function(t){const s={volume:e(this,i,o).volume,muted:e(this,i,o).muted};e(this,h).notify("volume-change",s,t)},It=function(t){c(this,N,e(this,i,o).currentTime),a(this,i,k).call(this,e(this,i,o).currentTime,t),e(this,h).notify("seeked",e(this,i,o).currentTime,t),Math.trunc(e(this,i,o).currentTime)===Math.trunc(e(this,i,o).duration)&&dt(e(this,i,o).duration)>dt(e(this,i,o).currentTime)&&(a(this,i,k).call(this,e(this,i,o).duration,t),e(this,i,o).ended||e(this,h).player.dispatch(new ne("media-play-request",{trigger:t})))},Ht=function(t){e(this,h).notify("seeking",e(this,i,o).currentTime,t)},Ft=function(t){const s={buffered:e(this,i,o).buffered,seekable:e(this,i,o).seekable};e(this,h).notify("progress",s,t)},Ut=function(t){e(this,h).notify("suspend",void 0,t)},Vt=function(t){e(this,h).notify("rate-change",e(this,i,o).playbackRate,t)},jt=function(t){const s=e(this,i,o).error;if(!s)return;const r={message:s.message,code:s.code,mediaError:s};e(this,h).notify("error",r,t)};var H,g,l,C,qt,Bt,Wt,it,_t;class ye{constructor(t,s){d(this,l);d(this,H);d(this,g);c(this,H,t),c(this,g,s),e(this,l,C).onaddtrack=a(this,l,qt).bind(this),e(this,l,C).onremovetrack=a(this,l,Bt).bind(this),e(this,l,C).onchange=a(this,l,Wt).bind(this),rt(e(this,g).audioTracks,"change",a(this,l,_t).bind(this))}}H=new WeakMap,g=new WeakMap,l=new WeakSet,C=function(){return e(this,H).media.audioTracks},qt=function(t){const s=t.track;if(s.label==="")return;const r=s.id.toString()||`native-audio-${e(this,g).audioTracks.length}`,f={id:r,label:s.label,language:s.language,kind:s.kind,selected:!1};e(this,g).audioTracks[X.add](f,t),s.enabled&&(f.selected=!0)},Bt=function(t){const s=e(this,g).audioTracks.getById(t.track.id);s&&e(this,g).audioTracks[X.remove](s,t)},Wt=function(t){let s=a(this,l,it).call(this);if(!s)return;const r=e(this,g).audioTracks.getById(s.id);r&&e(this,g).audioTracks[X.select](r,!0,t)},it=function(){return Array.from(e(this,l,C)).find(t=>t.enabled)},_t=function(t){const{current:s}=t.detail;if(!s)return;const r=e(this,l,C).getTrackById(s.id);if(r){const f=a(this,l,it).call(this);f&&(f.enabled=!1),r.enabled=!0}};var F,st;class Se{constructor(t,s){d(this,F);M(this,"scope",Xt());M(this,"currentSrc",null);M(this,"audioGain");this.media=t,this.ctx=s,this.audioGain=new ue(t,r=>{this.ctx.notify("audio-gain-change",r)})}setup(){new me(this,this.ctx),"audioTracks"in this.media&&new ye(this,this.ctx),ut(()=>{this.audioGain.destroy(),this.media.srcObject=null,this.media.removeAttribute("src");for(const t of this.media.querySelectorAll("source"))t.remove();this.media.load()})}get type(){return""}setPlaybackRate(t){this.media.playbackRate=t}async play(){return this.media.play()}async pause(){return this.media.pause()}setMuted(t){this.media.muted=t}setVolume(t){this.media.volume=t}setCurrentTime(t){this.media.currentTime=t}setPlaysInline(t){q(this.media,"playsinline",t)}async loadSource({src:t,type:s},r){this.media.preload=r||"",Zt(t)?(this.removeSource(),this.media.srcObject=t):(this.media.srcObject=null,te(t)?s!=="?"?this.appendSource({src:t,type:s}):(this.removeSource(),this.media.src=a(this,F,st).call(this,t)):(this.removeSource(),this.media.src=window.URL.createObjectURL(t))),this.media.load(),this.currentSrc={src:t,type:s}}appendSource(t,s){const r=this.media.querySelector("source[data-vds]"),f=r??document.createElement("source");q(f,"src",a(this,F,st).call(this,t.src)),q(f,"type",t.type!=="?"?t.type:s),q(f,"data-vds",""),r||this.media.append(f)}removeSource(){var t;(t=this.media.querySelector("source[data-vds]"))==null||t.remove()}}F=new WeakSet,st=function(t){const{clipStartTime:s,clipEndTime:r}=this.ctx.$state,f=s(),j=r();return f>0&&j>0?`${t}#t=${f},${j}`:f>0?`${t}#t=${f}`:j>0?`${t}#t=0,${j}`:t};var y,U,V,w,T,Kt,Yt,zt;class ge{constructor(t,s){d(this,T);d(this,y);d(this,U);d(this,V);d(this,w,Z(!1));c(this,y,t),c(this,U,s),a(this,T,Kt).call(this)}get supported(){return e(this,w).call(this)}async prompt(){if(!this.supported)throw Error("Not supported on this platform.");return this.type==="airplay"&&e(this,y).webkitShowPlaybackTargetPicker?e(this,y).webkitShowPlaybackTargetPicker():e(this,y).remote.prompt()}}y=new WeakMap,U=new WeakMap,V=new WeakMap,w=new WeakMap,T=new WeakSet,Kt=function(){var t;!((t=e(this,y))!=null&&t.remote)||!this.canPrompt||(e(this,y).remote.watchAvailability(s=>{e(this,w).set(s)}).catch(()=>{e(this,w).set(!1)}),lt(a(this,T,Yt).bind(this)))},Yt=function(){if(!e(this,w).call(this))return;const t=["connecting","connect","disconnect"],s=a(this,T,zt).bind(this);s(),rt(e(this,y),"playing",s);const r=new nt(e(this,y).remote);for(const f of t)r.add(f,s)},zt=function(t){const s=e(this,y).remote.state;if(s===e(this,V))return;const r={type:this.type,state:s};e(this,U).notify("remote-playback-change",r,t),c(this,V,s)};class ve extends ge{constructor(){super(...arguments);M(this,"type","airplay")}get canPrompt(){return"WebKitPlaybackTargetAvailabilityEvent"in window}}export{Se as H,ve as a};
